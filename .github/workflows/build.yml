name: NOMAD Build

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main", "develop" ]

env:
  BUILD_TYPE: Release

jobs:
  build-windows:
    name: Build on Windows
    runs-on: windows-latest
    continue-on-error: true
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Setup CMake
      uses: lukka/get-cmake@latest
    
    - name: Configure CMake
      run: cmake -B build -G "Visual Studio 17 2022" -A x64
    
    - name: Build NomadUI
      run: cmake --build build --config Release --target NomadUI_Core
    
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: nomad-windows-x64
        path: build/NomadUI/Release/NomadUI_Core.lib

  build-linux:
    name: Build on Linux
    runs-on: ubuntu-latest
    continue-on-error: true
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Check Linux Support
      id: check
      run: |
        echo "Linux platform is not yet fully supported"
        echo "Skipping build until implementation is complete"
        echo "skip=true" >> "$GITHUB_OUTPUT"
  
    - name: Install Dependencies
      if: steps.check.outputs.skip != 'true'
      run: |
        sudo apt-get update
        sudo apt-get install -y cmake g++ libgl1-mesa-dev libx11-dev
    
    - name: Configure CMake
      if: false
      # Build only core components on CI when optional/audio modules are missing
      run: cmake -B build -DNOMAD_CORE_MODE=ON -DCMAKE_BUILD_TYPE=Release
    
    - name: Build NomadUI
      if: false
      run: cmake --build build --config Release --target NomadUI_Core
    
    - name: Upload Artifacts
      if: false
      uses: actions/upload-artifact@v4
      with:
        name: nomad-linux-x64
        path: build/NomadUI/libNomadUI_Core.a

  build-macos:
    name: Build on macOS
    runs-on: macos-latest
    continue-on-error: true
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Check macOS Support
      id: check
      run: |
        echo "macOS platform is not yet fully supported"
        echo "Skipping build until implementation is complete"
        exit 0
    
    - name: Configure CMake
      if: false
      # Build only core components on CI when optional/audio modules are missing
      run: cmake -B build -DNOMAD_CORE_MODE=ON -DCMAKE_BUILD_TYPE=Release
    
    - name: Build NomadUI
      if: false
      run: cmake --build build --config Release --target NomadUI_Core
    
    - name: Upload Artifacts
      if: false
      uses: actions/upload-artifact@v4
      with:
        name: nomad-macos-universal
        path: build/NomadUI/libNomadUI_Core.a
